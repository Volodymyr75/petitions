# üìä Petition Analytics ‚Äî Project State

> **–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2025-12-28 15:45  
> **–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –®–≤–∏–¥–∫–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Ä–æ–∑–º–æ–≤–∏

---

## üìÖ –°–µ—Å—ñ—è 2025-12-26

**–ó—Ä–æ–±–ª–µ–Ω–æ:**
- ‚úÖ **Cabinet sync** ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–æ 5,360 –ø–µ—Ç–∏—Ü—ñ–π, —Ç–æ–ø –¥–µ–ª—å—Ç–∞: ID 9010 (+87 –≥–æ–ª–æ—Å—ñ–≤)
- ‚úÖ **–û—á–∏—Å—Ç–∫–∞ –±–∞–∑–∏** ‚Äî –≤–∏–¥–∞–ª–µ–Ω–æ 137 —Å–º—ñ—Ç—Ç—î–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ (title = "404. –¢–∞–∫–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–µ —ñ—Å–Ω—É—î")
- ‚úÖ **smart_complete.py** ‚Äî –¥–æ–¥–∞–Ω–æ retry –ª–æ–≥—ñ–∫—É (3 —Å–ø—Ä–æ–±–∏ –∑ –ø–∞—É–∑–∞–º–∏ 30/60/90—Å –¥–ª—è timeout)
- ‚úÖ **–ù–æ–≤—ñ –ø–µ—Ç–∏—Ü—ñ—ó** ‚Äî –¥–æ–¥–∞–Ω–æ 21 –Ω–æ–≤–∏—Ö (ID 257400-257700)
- ‚úÖ **–ü–ª–∞–Ω —Ä–µ–¥–∏–∑–∞–π–Ω—É –¥–∞—à–±–æ—Ä–¥—É** ‚Äî –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ 4-–±–ª–æ–∫–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –±–∞–∑–∏:** 45,254 president + 5,360 cabinet = **50,614 –ø–µ—Ç–∏—Ü—ñ–π**

---

## üé® –†–µ–¥–∏–∑–∞–π–Ω –¥–∞—à–±–æ—Ä–¥—É (–ü–õ–ê–ù)

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ 4 –±–ª–æ–∫—ñ–≤

| –ë–ª–æ–∫ | –ó–º—ñ—Å—Ç |
|------|-------|
| **1. Overview** | 4 KPI (total, success rate, median votes, response rate) + platform split |
| **2. Daily Dynamics** | +–Ω–æ–≤–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π, +–≥–æ–ª–æ—Å—ñ–≤, biggest movers (—Ç–æ–ø –ø–æ –¥–µ–ª—å—Ç–∞—Ö), 7-day sparkline |
| **3. Deep Analytics** | Histogram votes, timeline (stacked area by month), scatter text_length vs votes |
| **4. Pipeline Info** | Architecture diagram, tech stack, data freshness, "AI Agent coming soon" |

### –ù–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ (–ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏)

```sql
-- –©–æ–¥–µ–Ω–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –±–ª–æ–∫—É 2
CREATE TABLE daily_stats (
    date DATE PRIMARY KEY,
    president_new INTEGER,
    cabinet_new INTEGER,
    total_votes_delta INTEGER,
    status_changes JSON
);

-- –Ü—Å—Ç–æ—Ä—ñ—è –≥–æ–ª–æ—Å—ñ–≤ –¥–ª—è sparklines (–º–∞–π–±—É—Ç–Ω—î)
CREATE TABLE votes_history (
    petition_id VARCHAR,
    source VARCHAR,
    date DATE,
    votes INTEGER,
    PRIMARY KEY (petition_id, source, date)
);
```

### ‚ö†Ô∏è –í—ñ–¥–æ–º—ñ –ø—Ä–æ–±–ª–µ–º–∏

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–µ—Ç–∞–ª—ñ | –°—Ç–∞—Ç—É—Å |
|----------|--------|--------|
| `has_answer` –±–∞–≥ | 100% president –ø–µ—Ç–∏—Ü—ñ–π –º–∞—é—Ç—å `true`. –†—ñ—à–µ–Ω–Ω—è: —ñ–≥–Ω–æ—Ä—É—î–º–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `status='–ó –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é'` | üü° –Ü–≥–Ω–æ—Ä—É—î–º–æ |
| ~~–†—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –¥–∞—Ç~~ | –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `date_normalized` (DATE), –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–æ 100% –∑–∞–ø–∏—Å—ñ–≤ | ‚úÖ –í–∏—Ä—ñ—à–µ–Ω–æ |

---


## üéØ –ú–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç—É

–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π (–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç + –ö–∞–±–º—ñ–Ω) –∑:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –∑–±–æ—Ä–æ–º –¥–∞–Ω–∏—Ö
- –©–æ–¥–µ–Ω–Ω–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏
- –¢—Ä–µ–Ω–¥–∞–º–∏ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è–º–∏

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
petition/
‚îú‚îÄ‚îÄ etl/                    # Data pipeline —Å–∫—Ä–∏–ø—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py         # –û—Å–Ω–æ–≤–Ω–∏–π –ø–∞–π–ø–ª–∞–π–Ω (scrape ‚Üí DB ‚Üí JSON)
‚îÇ   ‚îú‚îÄ‚îÄ scraper_president.py
‚îÇ   ‚îú‚îÄ‚îÄ scraper_cabinet.py
‚îÇ   ‚îú‚îÄ‚îÄ smart_complete.py   # –†–æ–∑—É–º–Ω–µ –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ backfill_*.py       # –ë–µ–∫—Ñ—ñ–ª —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö
‚îÇ   ‚îî‚îÄ‚îÄ fix_cabinet_*.py    # –§—ñ–∫—Å–∏ –¥–ª—è Cabinet API
‚îú‚îÄ‚îÄ src/                    # React Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx       # –û—Å–Ω–æ–≤–Ω–∏–π UI (KPI, charts, trending)
‚îÇ   ‚îî‚îÄ‚îÄ analytics_data.json # –î–∞–Ω—ñ –¥–ª—è –¥–∞—à–±–æ—Ä–¥—É
‚îú‚îÄ‚îÄ petitions.duckdb        # DuckDB –±–∞–∑–∞ (~27MB)
‚îî‚îÄ‚îÄ netlify/                # Deployment –∫–æ–Ω—Ñ—ñ–≥–∏
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö (DuckDB)

### –¢–∞–±–ª–∏—Ü—ñ
| –¢–∞–±–ª–∏—Ü—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å |
|---------|--------|------|
| `petitions` | ‚úÖ –Ñ | +`votes_previous`, `updated_at`, `date_normalized` |
| `votes_history` | ‚úÖ –Ñ | –Ü—Å—Ç–æ—Ä—ñ—è –≥–æ–ª–æ—Å—ñ–≤ –¥–ª—è sparklines |
| `daily_stats` | ‚úÖ –Ñ | –ê–≥—Ä–µ–≥–æ–≤–∞–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–æ–±—É |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ petitions (2025-12-26)
| source | status | count |
|--------|--------|-------|
| president | –¢—Ä–∏–≤–∞—î –∑–±—ñ—Ä –ø—ñ–¥–ø–∏—Å—ñ–≤ | 533 |
| president | –ù–∞ —Ä–æ–∑–≥–ª—è–¥—ñ | 1,401 |
| president | –ó –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é | 1,252 |
| president | –ê—Ä—Ö—ñ–≤ | 42,044 |
| cabinet | Answered | 50 |
| cabinet | Approved | 190 |
| cabinet | Unsupported | 5,117 |

**–í—Å—å–æ–≥–æ:** ~50,700 –ø–µ—Ç–∏—Ü—ñ–π

---

## ‚úÖ –©–æ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ

1. **ETL Pipeline** (`pipeline.py`)
   - –°–∫—Ä–∞–ø—ñ–Ω–≥ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—å–∫–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π (active, in_process, processed, archive)
   - –°–∫—Ä–∞–ø—ñ–Ω–≥ –∫–∞–±–º—ñ–Ω—ñ–≤—Å—å–∫–∏—Ö –ø–µ—Ç–∏—Ü—ñ–π —á–µ—Ä–µ–∑ API
   - –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–µ–ª—å—Ç –≥–æ–ª–æ—Å—ñ–≤ (trending)
   - –ï–∫—Å–ø–æ—Ä—Ç –≤ `analytics_data.json`


2. **Dashboard** (`Dashboard.jsx`)
   - ‚úÖ –†–µ–¥–∏–∑–∞–π–Ω –Ω–∞ 4 –±–ª–æ–∫–∏ (Overview, Daily, Analytics, Pipeline)
   - ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Recharts (Histogram, AreaChart, ScatterChart)
   - ‚úÖ KPI —Ç–∞ Insight –±–ª–æ–∫–∏

3. **–î–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω—ñ**
   - `analytics_data.json` –æ–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–¥ –Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É (2025-12-26)
   - DB Schema: +`votes_history`, `daily_stats`, `date_normalized`

---

## üöß –©–æ –≤ –ø—Ä–æ—Ü–µ—Å—ñ / –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

### TODO:
- [x] –û–Ω–æ–≤–∏—Ç–∏ `Dashboard.jsx` (4 –±–ª–æ–∫–∏)
- [x] –û–Ω–æ–≤–∏—Ç–∏ `pipeline.py` (JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- [x] –û–Ω–æ–≤–∏—Ç–∏ —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ script `daily_sync.py` –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è `daily_stats`
- [x] –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ `scraper_detail.py` (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –Ω–æ–≤–æ–≥–æ HTML)
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ (cron / GitHub Actions)
- [ ] –î–æ–¥–∞—Ç–∏ OpenAI/LLM –¥–ª—è —á–∞—Ç-–±–æ—Ç–∞
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ (cron / GitHub Actions)
- [ ] –î–æ–¥–∞—Ç–∏ –¥–∞–Ω–∏—Ö –ø—Ä–æ "–ù–∞ —Ä–æ–∑–≥–ª—è–¥—ñ" ‚Äî days pending

---

## üîß –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏

```bash
# ETL Pipeline
cd etl && python pipeline.py

# Dev server
npm run dev

# Build
npm run build
```

---

## üí° –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```python
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–∑–∏
import duckdb
conn = duckdb.connect('petitions.duckdb')
print(conn.execute("SELECT source, status, COUNT(*) FROM petitions GROUP BY source, status").fetchdf())

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—å
print(conn.execute("SHOW TABLES").fetchall())
```

---

## üìù –ù–æ—Ç–∞—Ç–∫–∏

- Cabinet API —ñ–Ω–æ–¥—ñ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–µ–ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ (author = null)
- –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—å–∫—ñ –ø–µ—Ç–∏—Ü—ñ—ó –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤ (—É–∫—Ä.)
- –î–µ—è–∫—ñ —Å—Ç–∞—Ä—ñ –ø–µ—Ç–∏—Ü—ñ—ó –º–∞—é—Ç—å `status = 'Unknown'`
